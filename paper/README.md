# annuity-pricing Paper: Reproducibility Guide

**Title**: annuity-pricing: Open-Source Actuarial Pricing for FIA, RILA, and GLWB Products

**Authors**: Brandon Behring

**Submitted to**: arXiv (q-fin.PR - Quantitative Finance: Pricing)

**Zenodo DOI**: (to be assigned)

---

## Quick Start

To reproduce the paper and all figures:

```bash
cd /path/to/annuity-pricing
make env-paper      # Install LaTeX, Python dependencies
make figures        # Generate all figures (PDFs + CSVs)
make paper          # Compile LaTeX to PDF
```

The compiled paper will be at `paper/main.pdf`.

---

## Full Reproducibility

To run the complete pipeline (tests + figures + paper):

```bash
make reproduce
```

This target:
1. Runs all unit tests (`pytest tests/ -v`)
2. Generates all figures with deterministic seeds
3. Compiles the LaTeX document
4. Saves dependency manifest to `paper/artifacts/requirements-paper.txt`

---

## Directory Structure

```
paper/
├── main.tex              # LaTeX source document
├── references.bib        # Bibliography (BibTeX)
├── styles/
│   └── quantfin.cls      # Custom article class for arXiv quantfin papers
├── figures/
│   ├── payoff_buffer_floor_cap.pdf      # RILA/FIA payoff diagrams
│   ├── mc_convergence.pdf                # MC → BS convergence plot
│   ├── bs_financepy_parity.pdf           # BS vs financepy validation
│   ├── glwb_fee_surface.pdf              # GLWB fee sensitivity
│   ├── vm21_cte70.pdf                    # VM-21 CTE sensitivity
│   └── data/                             # CSV data underlying figures
├── tables/               # (reserved for table content)
├── appendix/             # (reserved for appendix content)
├── artifacts/
│   ├── requirements-paper.txt            # Generated dependency freeze
│   └── execution.log                     # Reproduction log
├── README.md             # This file
└── zenodo.json           # Zenodo deposit metadata
```

---

## Figure Generation Scripts

Each figure is generated by a dedicated Python script with deterministic seeds. To regenerate a single figure:

```bash
python -m scripts.figures.plot_rila_fia_payoffs       # Payoff diagrams
python -m scripts.figures.plot_mc_convergence         # MC convergence
python -m scripts.figures.plot_bs_parity              # BS parity
python -m scripts.figures.plot_glwb_fee_surface       # GLWB fee surface
python -m scripts.figures.plot_vm21_cte_sensitivity   # VM-21 CTE sensitivity
```

Output PDFs are saved to `paper/figures/` and underlying CSV data to `paper/figures/data/`.

### Seed Values

| Figure | Seed | Notes |
|--------|------|-------|
| RILA/FIA payoffs | N/A (deterministic) | No stochastic component |
| MC convergence | 1234 | Fixed for reproducibility |
| BS parity | N/A | Cross-validation against financepy |
| GLWB fee surface | 5678 | MC simulation with fixed seed |
| VM-21 CTE sensitivity | 9999 | Scenario generation with fixed seed |

---

## Environment Setup

### LaTeX Installation

The paper requires a complete LaTeX distribution:

**macOS** (Homebrew):
```bash
brew install texlive
```

**Ubuntu/Debian**:
```bash
sudo apt-get install texlive-full
```

**Windows** (MiKTeX or TeX Live):
- Download from https://www.tug.org/texlive/ or https://miktex.org/

### Python Environment

Install the library with all extras:

```bash
pip install -e ".[validation,viz]"
pip install latexmk nbconvert papermill
```

This installs:
- Core dependencies: numpy, scipy, pandas
- Validation: financepy, QuantLib, pyfeng
- Visualization: matplotlib, seaborn
- Notebook execution: papermill, nbclient

---

## Validation Against External Libraries

The paper includes cross-validation against three established libraries:

### 1. FinancePy

Validates Black-Scholes pricing and Greeks:

```bash
pytest tests/unit/test_adapters.py::TestFinancepyAdapter -v
```

**Expected**: 7 tests pass (BS prices and Greeks)

### 2. QuantLib

Validates yield curve and bond pricing:

```bash
pytest tests/unit/test_adapters.py::TestQuantLibAdapter -v
```

**Expected**: 7 tests pass (bond pricing, yield curves)

### 3. PyFeng

Validates Monte Carlo convergence:

```bash
pytest tests/unit/test_adapters.py::TestPyfengAdapter -v
```

**Expected**: 4 tests skipped (scipy 1.12+ compatibility)

---

## Dependency Versions

All dependencies are pinned in `pyproject.toml`. To see the exact versions used in this reproduction:

```bash
pip freeze > paper/artifacts/requirements-paper.txt
cat paper/artifacts/requirements-paper.txt
```

Key versions:
- Python: 3.10–3.13 (tested on 3.12)
- NumPy: ~1.26
- SciPy: ~1.13
- FinancePy: ~0.4.0 (for cross-validation)
- QuantLib: ~1.33 (for cross-validation)

---

## Paper Compilation

To compile the LaTeX document:

```bash
cd paper
latexmk -pdf -shell-escape main.tex
```

This generates:
- `paper/main.pdf` — Compiled paper
- `paper/main.aux`, `paper/main.bbl` — Auxiliary LaTeX files
- `paper/main.log` — Compilation log

To clean LaTeX artifacts:

```bash
make clean-paper
# or manually:
cd paper && latexmk -C
```

---

## Regulatory Prototypes

The paper includes prototype implementations of VM-21 and VM-22 reserve calculations. These are **NOT** suitable for regulatory filing without extensive validation against NAIC prescribed scenarios.

### VM-21 (Variable Annuity Reserves)

The implementation provides CTE70 calculation but uses simplified economic scenario generation (not NAIC AG43 prescribed scenarios).

To test VM-21 functionality:

```bash
pytest tests/unit/regulatory/test_vm21.py -v
```

### VM-22 (Fixed Annuity Reserves)

The implementation provides deterministic and stochastic reserve methodologies but uses simplified rate scenarios.

To test VM-22 functionality:

```bash
pytest tests/unit/regulatory/test_vm22.py -v
```

**Disclaimer**: These modules are labeled as prototypes in the paper with clear documentation of gaps relative to NAIC guidance.

---

## Troubleshooting

### Issue: LaTeX compilation fails with "quantfin.cls not found"

**Solution**: Ensure you're in the `paper/` directory when compiling:
```bash
cd /path/to/annuity-pricing/paper
latexmk -pdf -shell-escape main.tex
```

### Issue: Figure scripts fail with "Module not found: annuity_pricing"

**Solution**: Install the library in editable mode from the project root:
```bash
cd /path/to/annuity-pricing
pip install -e .
```

### Issue: FinancePy tests fail

**Solution**: Install the validation dependencies:
```bash
pip install -e ".[validation]"
```

### Issue: Bibliography not generated

**Solution**: Ensure you're using `biblatex` and `\printbibliography`. Recompile:
```bash
latexmk -pdf -shell-escape main.tex
```

---

## Citation

To cite this paper:

```bibtex
@article{behring2025annuitypricing,
  author = {Behring, Brandon},
  title = {annuity-pricing: Open-Source Actuarial Pricing for FIA, RILA, and GLWB Products},
  journal = {arXiv preprint arXiv:XXXX.XXXXX},
  year = {2025},
  note = {https://github.com/brandon-behring/annuity-pricing}
}
```

Or use the CITATION.cff in the repository root.

---

## Zenodo Deposition

Upon arXiv submission, this paper and all artifacts are archived on Zenodo:

- **DOI**: (assigned upon publication)
- **Contents**: Source code, compiled PDF, figure PDFs, underlying data (CSVs), environment files
- **License**: MIT

To link to Zenodo: (URL to be updated after publication)

---

## Support and Issues

For questions or issues related to:

- **Paper content**: Contact author directly or open a GitHub issue at https://github.com/brandon-behring/annuity-pricing
- **Reproduction**: Open a GitHub issue with reproduction steps
- **Library features**: See https://annuity-pricing.readthedocs.io or open a GitHub issue

---

## License

The annuity-pricing library and this paper are released under the **MIT License**. See `LICENSE` in the repository root.

---

## Acknowledgments

- **Cross-validation libraries**: FinancePy, QuantLib, PyFeng
- **Data**: SOA 2012 IAM mortality table, WINK insurance market data
- **Inspiration**: Hull (2021), Glasserman (2004), Hardy (2003) textbooks

---

**Last Updated**: 2025-12-06
